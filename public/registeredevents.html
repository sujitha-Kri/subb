<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Registered Events (Admin)</title>
  <style>
body {
  background: url('z.jpeg') no-repeat center center/cover;
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 0;
}


/* Overlay effect */
.overlay {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.4);
  z-index: 1;
}

/* Container style */
.container {
  max-width: 1000px;
  margin: 40px auto;
  padding: 20px 30px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(12px);
  border-radius: 15px;
  box-shadow: 0 0 25px rgba(0,0,0,0.3);
  position: relative;
  z-index: 2;
}

/* Titles */
h1, h3 {
  text-align: center;
  color: #5c2d91;
  margin-bottom: 20px;

}

/* Login Box */
.login-box {
  max-width: 400px;
  background: rgba(255,255,255,0.1);
  padding: 40px;
  margin: 50px auto;
  border-radius: 15px;
  backdrop-filter: blur(12px);
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
  text-align: center;
  color: #160505;
}
.login-box input {
  width: 90%;
  padding: 12px;
  margin: 10px 0;
  border-radius: 25px;
  border: 1px solid #250c0c;
  background: rgba(255,255,255,0.2);
  color: #1c1919;
  outline: none;
}
.login-box input::placeholder {
  color: #1e1818;
}
.login-box button {
  width: 95%;
  padding: 12px;
  border: none;
  border-radius: 25px;
  background: #5c2d91;
  color: #fff;
  font-weight: 600;
  cursor: pointer;
  transition: 0.3s;
  margin-top: 10px;
}
.login-box button:hover {
  background: #7c4dff;
}

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: rgba(255,255,255,0.1);
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}
thead {
  background: #5c2d91;
  color: #fff;
}
th, td {
  padding: 12px 15px;
  text-align: left;
  font-size: 14px;
  color: #190505;
}
tbody tr:hover {
  background: rgba(255,255,255,0.15);
  transition: 0.3s;
}

/* Action Buttons */
.action-btn {
  padding: 6px 12px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  color: #fff;
  font-weight: 500;
  margin-right: 5px;
}
.attended-btn {
  background: #10b981;
}
.attended-btn:hover {
  background: #059669;
}
.not-attended-btn {
  background: #ef4444;
}
.not-attended-btn:hover {
  background: #b91c1c;
}

/* Section headings inside container */
#eventsSection h3 {
  margin-top: 30px;
  color: #c16844;
}

/* Responsive */
@media(max-width: 768px){
  th, td {
    font-size: 12px;
  }
  .login-box, .container {
    padding: 20px;
  }
}
</style>


</head>
<body>
  <div class="container">

    <!-- Admin Login Section -->
    <div id="loginSection" class="login-box">
      <h2>Admin Login</h2>
      <input type="text" id="username" placeholder="Enter Username"><br>
      <input type="password" id="password" placeholder="Enter Password"><br>
      <button onclick="checkLogin()">Login</button>
      <p id="loginMessage" style="color:red;"></p>
    </div>
    
    <!-- Events Section -->
    <div id="eventsSection" style="display:none;">
      <h1>All Registered Events</h1>

      <h2>Pending Registrations</h2>
      
      <table id="pendingTable">
        <thead>
          <tr>
            <th>Name</th><th>Email</th><th>Event</th><th>Date</th><th>Time</th><th>Action</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <h3>Attended Registrations</h3>
      <table id="attendedTable">
        <thead>
          <tr>
            <th>Name</th><th>Email</th><th>Event</th><th>Date</th><th>Time</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <h3>Not Attended Registrations</h3>
      <table id="notAttendedTable">
        <thead>
          <tr>
            <th>Name</th><th>Email</th><th>Event</th><th>Date</th><th>Time</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // Admin login
    function checkLogin() {
      const user = document.getElementById('username').value.trim();
      const pass = document.getElementById('password').value.trim();
      const msg = document.getElementById('loginMessage');

      if (user === "admin" && pass === "939273") {
        document.getElementById('loginSection').style.display = "none";
        document.getElementById('eventsSection').style.display = "block";
        loadRegistrations();
      } else {
        msg.textContent = "❌ Invalid username or password!";
      }
    }

    // Load all registrations and group by attendance
    async function loadRegistrations() {
      try {
        const res = await fetch('/registrations');
        const data = await res.json();

        const pendingBody = document.querySelector("#pendingTable tbody");
        const attendedBody = document.querySelector("#attendedTable tbody");
        const notAttendedBody = document.querySelector("#notAttendedTable tbody");

        pendingBody.innerHTML = "";
        attendedBody.innerHTML = "";
        notAttendedBody.innerHTML = "";

        data.forEach(reg => {
          const row = `
            <td>${reg.name}</td>
            <td>${reg.email}</td>
            <td>${reg.event}</td>
            <td>${reg.date}</td>
            <td>${reg.time}</td>
          `;

          if (reg.attendance === "Attended") {
            attendedBody.innerHTML += `<tr>${row}</tr>`;
          } else if (reg.attendance === "Not Attended") {
            notAttendedBody.innerHTML += `<tr>${row}</tr>`;
          } else {
            pendingBody.innerHTML += `
              <tr>
                ${row}
                <td>
                  <button class="action-btn attended-btn" onclick="markAttendance('${reg._id}', 'Attended')">Attended</button>
                  <button class="action-btn not-attended-btn" onclick="markAttendance('${reg._id}', 'Not Attended')">Not Attended</button>
                </td>
              </tr>`;
          }
        });
      } catch (err) {
        console.error("Load error:", err);
        alert("⚠️ Could not load registrations");
      }
    }

    async function markAttendance(id, status) {
  try {
    const res = await fetch(`/registrations/${id}/attendance`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ status })
    });

    if (res.ok) {
      loadRegistrations(); // reload after update
    } else {
      const result = await res.json();
      alert("❌ " + result.error);
    }
  } catch (err) {
    console.error("Update error:", err);
    alert("⚠️ Failed to update attendance");
  }
}

  </script>
</body>
</html>
